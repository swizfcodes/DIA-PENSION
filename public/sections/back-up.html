<!-- Backup Payroll Files Section -->
<div class="p-6">
  <div class="flex items-center justify-between mb-4">
    <div class="flex items-center space-x-3">
      <!-- Icon -->
      <div class="bg-green-500 text-white p-3 rounded-full shadow">
        ðŸ“¦
      </div>
      <h2 class="text-2xl font-bold text-green-800">Backup Payroll Files</h2>
    </div>
  </div>

  <!-- Description -->
  <p class="text-gray-600 font-semibold mb-6 lg:text-lg">Securely backup current payroll files before making changes or calculations.</p>

  <!-- Action -->
  <div class="flex justify-center">
    <button id="openBackupModalBtn" class="px-8 py-3 bg-green-500 text-white rounded-lg shadow hover:bg-green-600 transition">
      Backup Payroll Files
    </button>
  </div>
</div>

<!-- Section displayed after successful backup -->
<div id="proceedToPayroll" class="hidden p-6">
  <h3 class="text-xl font-semibold text-blue-700 mb-3">âœ… Backup Successful</h3>
  <p class="text-gray-600 mb-4">Your payroll files have been safely backed up. You may now proceed to calculations.</p>
  <div class="flex justify-center">
    <button onclick="window.navigation.navigateToSection('payroll-calculations', 'Payroll Calculations')" class="px-6 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition">
      Payroll Calculations
    </button>
  </div>
</div>

<!-- Backup Confirmation Modal -->
<div id="backupModal" class="fixed inset-0 bg-black bg-opacity-40 hidden flex items-center justify-center z-50">
  <div class="bg-white w-11/12 md:w-1/3 rounded-xl shadow-lg overflow-hidden">
    <!-- Header -->
    <div class="flex justify-between items-center bg-yellow-500 text-white px-4 py-3">
      <h3 class="text-lg font-semibold">Confirm Backup</h3>
      <button id="closeBackupModalBtn" class="text-white hover:text-gray-200">âœ–</button>
    </div>

    <!-- Body -->
    <div class="p-6">
      <p class="text-gray-700 mb-4">Are you sure you want to <span class="font-semibold">backup payroll files</span>? This ensures you can restore them later if needed.</p>
      <div id="backupStatus" class="hidden text-blue-700 font-semibold mt-2"></div>
    </div>

    <!-- Footer -->
    <div class="flex justify-end space-x-3 bg-gray-100 px-4 py-3">
      <button id="cancelBackupBtn" class="px-6 py-2 bg-gray-300 hover:bg-gray-400 rounded-lg">Cancel</button>
      <button id="confirmBackupBtn" class="px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg">Yes, Backup</button>
    </div>
  </div>
</div>

<script>
(function () {
  const modal = document.getElementById("backupModal");
  const openBtn = document.getElementById("openBackupModalBtn");
  const closeBtn = document.getElementById("closeBackupModalBtn");
  const cancelBtn = document.getElementById("cancelBackupBtn");
  const confirmBtn = document.getElementById("confirmBackupBtn");
  const statusEl = document.getElementById("backupStatus");
  const proceedSection = document.getElementById("proceedToPayroll");

  // Open modal
  openBtn.addEventListener("click", () => {
    modal.classList.remove("hidden");
    statusEl.classList.add("hidden");
    statusEl.textContent = "";
  });

  // Close modal
  function closeModal() {
    modal.classList.add("hidden");
  }
  closeBtn.addEventListener("click", closeModal);
  cancelBtn.addEventListener("click", closeModal);

  async function runBackup() {
    try {
      // Show loading
      showNotification('Processing backup...', 'info');
      
      const response = await fetch('/backup', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${localStorage.getItem('token')}`
        },
        body: JSON.stringify({
        })
      });

      const result = await response.json();
      
      if (result.success) {
        showNotification('Backup completed successfully!', 'success');
        updateDashboardStats(); // Refresh dashboard
      } else {
        showNotification('âŒ Backup failed: ' + result.message, 'error');
      }
    } catch (error) {
      showNotification('âŒ Error: ' + error.message, 'error');
    }
  }

  // Wire up button
  //document.getElementById('btnBackup').addEventListener('click', runBackup);

  // Confirm backup (simulate)
  confirmBtn.addEventListener("click", () => {
    statusEl.classList.remove("hidden");
    statusEl.textContent = "Backing up payroll files...";
    confirmBtn.disabled = true;

    runBackup();

    setTimeout(() => {
      statusEl.textContent = "âœ… Payroll files successfully backed up.";
      confirmBtn.disabled = false;

      setTimeout(() => {
        closeModal();
        proceedSection.classList.remove("hidden");
      }, 1500);
    }, 1500);
  });
})();
</script>




